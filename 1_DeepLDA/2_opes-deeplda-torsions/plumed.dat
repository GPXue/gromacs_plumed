
# vim:ft=plumed

# Compute torsion angles, as well as energy
MOLINFO STRUCTURE=input.ala2.pdb
phi: TORSION ATOMS=@phi-2
psi: TORSION ATOMS=@psi-2
theta: TORSION ATOMS=6,5,7,9
xi: TORSION ATOMS=16,15,17,19
ene: ENERGY

# Compute sin / cos of torsions
sin_phi: CUSTOM ARG=phi FUNC=sin(x) PERIODIC=NO
cos_phi: CUSTOM ARG=phi FUNC=cos(x) PERIODIC=NO
sin_psi: CUSTOM ARG=psi FUNC=sin(x) PERIODIC=NO
cos_psi: CUSTOM ARG=psi FUNC=cos(x) PERIODIC=NO
sin_theta: CUSTOM ARG=theta FUNC=sin(x) PERIODIC=NO
cos_theta: CUSTOM ARG=theta FUNC=cos(x) PERIODIC=NO
sin_xi: CUSTOM ARG=xi FUNC=sin(x) PERIODIC=NO
cos_xi: CUSTOM ARG=xi FUNC=cos(x) PERIODIC=NO

# Compute descriptors
#INCLUDE FILE=../plumed-distances.dat

# Compute DeepLDA CV
deep: PYTORCH_MODEL FILE=model.ptc ARG=sin_phi,cos_phi,sin_psi,cos_psi,sin_theta,cos_theta,sin_xi,cos_xi

deep_mod: CUSTOM ARG=deep.node-0 FUNC=x+x^3 PERIODIC=NO

# Apply OPES bias
opes: OPES_METAD ARG=deep_mod PACE=500 BARRIER=30

# Print 
PRINT FMT=%g STRIDE=500 FILE=COLVAR ARG=*

ENDPLUMED

